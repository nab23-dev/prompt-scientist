<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Prompt-Scientist ‚Äî Profile</title>
  <style>
    :root{
      --bg:#f8f9fb; --fg:#111; --card:#fff;
      --border:#e5e7eb; --accent:#2563eb;
      --accent-hover:#1e40af; --muted:#6b7280;
      --error:#dc2626; --success:#16a34a;
    }
    body{margin:0;font-family:Inter,system-ui,Roboto,sans-serif;
      background:var(--bg);color:var(--fg);}
    header{padding:18px 28px;border-bottom:1px solid var(--border);
      background:#fff;box-shadow:0 2px 6px rgba(0,0,0,0.05);
      display:flex;justify-content:space-between;align-items:center}
    .brand{font-size:24px;font-weight:700;color:var(--accent)}
    .logout{background:var(--error);color:#fff;border:none;
      padding:8px 16px;border-radius:6px;cursor:pointer;font-weight:600}
    .logout:hover{background:#b91c1c}
    main{max-width:900px;margin:30px auto;padding:0 16px}
    .card{background:var(--card);border:1px solid var(--border);
      border-radius:12px;padding:24px;box-shadow:0 4px 10px rgba(0,0,0,0.05);margin-bottom:24px}
    h2{margin-top:0}
    .profile-info p{margin:6px 0;font-size:15px}
    .profile-info span{font-weight:600;color:var(--accent)}
    label{display:block;font-size:14px;margin-top:12px}
    input,textarea{width:100%;padding:10px;border-radius:8px;
      border:1px solid var(--border);margin-top:6px;font-family:inherit}
    input:focus,textarea:focus{border-color:var(--accent);outline:none;
      box-shadow:0 0 0 3px rgba(37,99,235,0.15)}
    .btn{margin-top:16px;padding:12px 20px;border:none;border-radius:8px;
      background:var(--accent);color:#fff;font-weight:600;cursor:pointer}
    .btn:hover{background:var(--accent-hover)}
    .note{font-size:13px;color:var(--muted);margin-top:6px}
    .posts{display:grid;gap:16px}
    .post{border:1px solid var(--border);border-radius:10px;
      padding:16px;background:#fff;box-shadow:0 2px 6px rgba(0,0,0,0.05)}
    .post h4{margin:0;color:var(--accent)}
    .post small{color:var(--muted)}
    .delete{margin-top:10px;padding:6px 12px;border:none;
      background:var(--error);color:#fff;border-radius:6px;cursor:pointer}
    .delete:hover{background:#b91c1c}
  </style>
</head>
<body>
  <header>
    <div class="brand">Prompt-Scientist</div>
    <button class="logout" onclick="doLogout()">Logout</button>
  </header>
  <main>
    <!-- Profile Card -->
    <div class="card profile-info">
      <h2>üë§ Profile Information</h2>
      <p><span>Name:</span> <span id="prof_name">...</span></p>
      <p><span>Username:</span> <span id="prof_username">...</span></p>
      <p><span>Email:</span> <span id="prof_email">...</span></p>
    </div>

    <!-- Post Form -->
    <div class="card">
      <h2>‚úçÔ∏è Create a Post</h2>
      <label>Caption <input id="post_caption" placeholder="Write a caption..." /></label>
      <label>Prompt <textarea id="post_prompt" rows="3" placeholder="Enter your AI prompt..."></textarea></label>
      <label>Image URL 
        <input id="post_image" placeholder="Paste direct link (Upload at https://imgbb.com or similar)" />
      </label>
      <p class="note">üëâ ‡¶â‡¶™‡¶∞‡ßá‡¶∞ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï‡ßá ‡¶ó‡¶ø‡ßü‡ßá ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®, ‡¶§‡¶æ‡¶∞‡¶™‡¶∞ ‡¶°‡¶æ‡¶á‡¶∞‡ßá‡¶ï‡ßç‡¶ü ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¶‡¶ø‡¶®‡•§</p>
      <button class="btn" onclick="createPost()">Post</button>
    </div>

    <!-- My Posts -->
    <div class="card">
      <h2>üìú My Posts</h2>
      <div class="posts" id="myPosts"></div>
    </div>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { getFirestore, doc, getDoc, collection, addDoc, query, where, getDocs, deleteDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // ‚úÖ Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyDDgwI90DMBa25JOkNR2Oec32kfgIt5TNg",
      authDomain: "prompt-scientist.firebaseapp.com",
      projectId: "prompt-scientist",
      storageBucket: "prompt-scientist.firebasestorage.app",
      messagingSenderId: "240705146800",
      appId: "1:240705146800:web:e7f05107761f4d3007d075"
    };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // ‚úÖ Redirect if not logged in
    onAuthStateChanged(auth, async (user)=>{
      if(!user){ location.href="index.html"; return; }
      const userDoc = await getDoc(doc(db,"users",user.uid));
      if(userDoc.exists()){
        const d = userDoc.data();
        document.getElementById("prof_name").innerText = d.name||"";
        document.getElementById("prof_username").innerText = d.username||"";
        document.getElementById("prof_email").innerText = d.email||"";
        loadPosts(user.uid);
      }
    });

    // ‚úÖ Logout
    window.doLogout = async function(){
      await signOut(auth);
      localStorage.removeItem("ps_auth");
      location.href="index.html";
    }

    // ‚úÖ Create Post
    window.createPost = async function(){
      const user = auth.currentUser;
      if(!user) return;

      const caption = document.getElementById("post_caption").value.trim();
      const prompt = document.getElementById("post_prompt").value.trim();
      const imageURL = document.getElementById("post_image").value.trim();

      if(!caption || !prompt){ alert("Caption & Prompt required"); return; }

      const userDoc = await getDoc(doc(db,"users",user.uid));
      const u = userDoc.data();

      await addDoc(collection(db,"posts"),{
        uid:user.uid,
        name:u.name,
        username:u.username,
        email:u.email,
        caption, prompt, imageURL,
        timestamp:serverTimestamp()
      });

      document.getElementById("post_caption").value="";
      document.getElementById("post_prompt").value="";
      document.getElementById("post_image").value="";
      loadPosts(user.uid);
    }

    // ‚úÖ Load My Posts
    async function loadPosts(uid){
      const q = query(collection(db,"posts"), where("uid","==",uid));
      const snap = await getDocs(q);
      const list = document.getElementById("myPosts");
      list.innerHTML="";
      snap.forEach(docSnap=>{
        const d = docSnap.data();
        const div = document.createElement("div");
        div.className="post";
        div.innerHTML = `
          <h4>${d.caption||""}</h4>
          <p>${d.prompt||""}</p>
          ${d.imageURL ? `<img src="${d.imageURL}" style="max-width:100%;border-radius:8px;margin-top:6px">` : ""}
          <small>Posted by ${d.username||""}</small><br>
          <button class="delete" onclick="deletePost('${docSnap.id}')">Delete</button>
        `;
        list.appendChild(div);
      });
    }

    // ‚úÖ Delete Post
    window.deletePost = async function(id){
      if(confirm("Delete this post?")){
        await deleteDoc(doc(db,"posts",id));
        loadPosts(auth.currentUser.uid);
      }
    }
  </script>
</body>
</html>
