<!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Prompt-Scientist ‚Äî Profile</title>
  <style>
    :root{
      --bg:#f3f4f6;
      --card:#fff;
      --accent:#2563eb;
      --accent-hover:#1e40af;
      --border:#e5e7eb;
      --muted:#6b7280;
      --shadow:0 6px 18px rgba(0,0,0,0.06);
      --radius:14px;
      --maxw:880px;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:Inter,system-ui,Roboto,"Noto Sans",sans-serif;background:var(--bg);color:#111827;}
    header{
      position:sticky;top:0;z-index:50;background:#fff;border-bottom:1px solid var(--border);
      padding:16px 20px;display:flex;justify-content:space-between;align-items:center;
      box-shadow:0 2px 10px rgba(0,0,0,0.04);
    }
    header h1{font-size:22px;font-weight:700;color:var(--accent)}
    header button{
      padding:8px 16px;border:none;border-radius:8px;background:var(--accent);color:#fff;font-weight:600;cursor:pointer;
      transition:background .2s;
    }
    header button:hover{background:var(--accent-hover);}

    .container{max-width:var(--maxw);margin:20px auto;padding:0 18px;display:grid;gap:22px;}
    .card{background:var(--card);border-radius:var(--radius);padding:20px;box-shadow:var(--shadow);}
    .profile-info h2{margin-bottom:6px;font-size:20px}
    .profile-info p{color:var(--muted);font-size:14px}

    form label{display:block;margin-top:12px;font-weight:600;font-size:14px;}
    form input, form textarea{
      width:100%;margin-top:6px;padding:10px;border-radius:10px;border:1px solid var(--border);font-size:14px;
    }
    form textarea{min-height:80px;resize:vertical;}
    form button{
      margin-top:16px;padding:12px 18px;border:none;border-radius:10px;background:var(--accent);color:#fff;
      font-weight:600;cursor:pointer;transition:background .2s;
    }
    .manage-btn {
  display:inline-block;
  margin-top:16px;
  padding:10px 18px;
  border:none;
  border-radius:10px;
  background:linear-gradient(135deg,#2563eb,#1e40af);
  color:#fff;
  font-weight:600;
  font-size:15px;
  cursor:pointer;
  transition:all .25s ease;
  box-shadow:0 4px 10px rgba(37,99,235,0.25);
}
.manage-btn:hover {
  transform:translateY(-2px);
  background:linear-gradient(135deg,#1e3a8a,#1e40af);
  box-shadow:0 6px 14px rgba(30,58,138,0.35);
    }
    form button:hover{background:var(--accent-hover);}
    .msg{margin-top:10px;font-size:14px;color:var(--muted)}

    .posts{display:grid;gap:18px;}
    .post{padding:16px;display:flex;flex-direction:column;gap:10px;border:1px solid var(--border);border-radius:12px;background:#fff;}
    .post h3{font-size:16px;font-weight:600;}
    .post img{max-width:100%;border-radius:10px;object-fit:cover}
    .post .prompt{background:#f9fafb;border:1px solid var(--border);padding:10px;border-radius:8px;
      font-family:ui-monospace,monospace;font-size:13px}
    .post button{align-self:flex-end;padding:6px 12px;font-size:13px;background:#ef4444;color:#fff;
      border:none;border-radius:8px;cursor:pointer;}
    .post button:hover{background:#b91c1c;}

    .empty{padding:28px;text-align:center;color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <h1>Prompt-Scientist</h1>
    <button id="logoutBtn">Logout</button>
  </header>

  <main class="container">
    <!-- Profile -->
    <section class="card profile-info">
  <h2 id="userName">Loading...</h2>
  <p><strong>Username:</strong> <span id="userUsername"></span></p>
  <p><strong>Email:</strong> <span id="userEmail"></span></p>

  <button id="manageAccountBtn" class="manage-btn">Manage Account</button>
    </section>

    <!-- New Post Form -->
    <section class="card">
      <h2>üìù ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
      <p class="msg">üì∑ ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá <a href="https://postimages.org/" target="_blank">postimages.org</a> ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç (üëâDirect link) ‡¶¶‡¶ø‡¶®‡•§</p>
      <form id="postForm">
        <label>Image URL
          <input id="imageURL" type="url" placeholder="https://i.postimg.cc/..."/>
        </label>
        <label>Caption (optional)
          <textarea id="caption" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶™‡¶∂‡¶® ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..."></textarea>
        </label>
        <label>Prompt (required)
          <textarea id="prompt" required placeholder="AI image prompt ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..."></textarea>
        </label>
        <button type="submit">üöÄ Submit Post</button>
      </form>
    </section>

    <!-- My Posts -->
    <section class="card">
      <h2>üìå ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶™‡ßã‡¶∏‡ßç‡¶ü‡¶ó‡ßÅ‡¶≤‡ßã</h2>
      <div id="myPosts" class="posts"></div>
    </section>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, query, where, serverTimestamp, doc, deleteDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDDgwI90DMBa25JOkNR2Oec32kfgIt5TNg",
      authDomain: "prompt-scientist.firebaseapp.com",
      projectId: "prompt-scientist",
      storageBucket: "prompt-scientist.firebasestorage.app",
      messagingSenderId: "240705146800",
      appId: "1:240705146800:web:e7f05107761f4d3007d075"
    };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const userName=document.getElementById("userName");
    const userUsername=document.getElementById("userUsername");
    const userEmail=document.getElementById("userEmail");
    const postForm=document.getElementById("postForm");
    const myPosts=document.getElementById("myPosts");
    const logoutBtn=document.getElementById("logoutBtn");

    let currentUser=null;
    let userData=null;

    // üîπ Auth state check
    onAuthStateChanged(auth,async(u)=>{
      if(!u){location.href="index.html";return;}
      currentUser=u;

      // üîπ Get user profile
      const userRef = doc(db, "users", u.uid);
      const userSnap = await getDoc(userRef);
      if(userSnap.exists()){
        userData = userSnap.data();
        userName.textContent = userData.name || "User";
        userUsername.textContent = userData.username ? "@" + userData.username : "";
        userEmail.textContent = userData.email || u.email;
      } else {
        userData = { name:"User", username:"", email:u.email };
        userName.textContent = "User";
        userEmail.textContent = u.email;
      }

      loadPosts();
    });

    logoutBtn.addEventListener("click",()=>signOut(auth));

    // üîπ Load posts
    async function loadPosts(){
      myPosts.innerHTML="‚è≥ Loading...";
      const q=query(collection(db,"posts"),where("uid","==",currentUser.uid));
      const snap=await getDocs(q);
      if(snap.empty){myPosts.innerHTML='<div class="empty">‚ùå ‡¶Ü‡¶™‡¶®‡¶ø ‡¶è‡¶ñ‡¶®‡¶ì ‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßá‡¶®‡¶®‡¶ø‡•§</div>';return;}
      myPosts.innerHTML="";
      snap.forEach(docSnap=>{
        const d=docSnap.data();
        const div=document.createElement("div");
        div.className="post";
        div.innerHTML=`
          <h3>${d.caption||"(No caption)"}</h3>
          ${d.imageURL?`<img src="${d.imageURL}" alt="post">`:""}
          <div class="prompt">${d.prompt}</div>
          <button data-id="${docSnap.id}">Delete</button>
          <p class="msg">${d.approved?"‚úÖ Approved":"‚è≥ Pending approval"}</p>
        `;
        div.querySelector("button").addEventListener("click",()=>deletePost(docSnap.id));
        myPosts.appendChild(div);
      });
    }

    // üîπ New post
    postForm.addEventListener("submit",async e=>{
      e.preventDefault();
      const imageURL=document.getElementById("imageURL").value.trim();
      const caption=document.getElementById("caption").value.trim();
      const prompt=document.getElementById("prompt").value.trim();
      if(!prompt){alert("‚ö†Ô∏è Prompt is required");return;}

      // üîπ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá global settings ‡¶•‡ßá‡¶ï‡ßá autoApprove ‡¶Æ‡¶æ‡¶®‡¶ü‡¶æ ‡¶Ü‡¶®‡ßÅ‡¶®
const settingsRef = doc(db, "settings", "global");
const settingsSnap = await getDoc(settingsRef);
let autoApprove = false;
if (settingsSnap.exists()) {
  autoApprove = settingsSnap.data().autoApprove === true;
}

// üîπ ‡¶è‡¶¨‡¶æ‡¶∞ ‡¶™‡ßã‡¶∏‡ßç‡¶ü add ‡¶ï‡¶∞‡ßÅ‡¶®
await addDoc(collection(db,"posts"),{
  uid: currentUser.uid,
  name: userData?.name || "",
  username: userData?.username || "",
  email: userData?.email || currentUser.email,
  imageURL, caption, prompt,
  timestamp: serverTimestamp(),
  approved: autoApprove   // ‚úÖ autoApprove true ‡¶π‡¶≤‡ßá ‡¶Ö‡¶ü‡ßã approve ‡¶π‡¶¨‡ßá
});

      alert("‚úÖ Post submitted! Pending admin approval.");
      postForm.reset();
      loadPosts();
    });

    // üîπ Delete post
    async function deletePost(id){
      if(confirm("‚ö†Ô∏è ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?")){
        await deleteDoc(doc(db,"posts",id));
        loadPosts();
      }
    }
  </script>
</body>
</html>
