<!doctype html>
<html lang="bn">  
<head>  
  <meta charset="utf-8"/>  
  <meta name="viewport" content="width=device-width,initial-scale=1"/>  
  <title>Prompt-Scientist ‚Äî Profile</title>  
  <style>  
    :root{  
      --bg:#f9fafb;  
      --card:#ffffff;  
      --accent:#2563eb;  
      --accent-hover:#1e40af;  
      --border:#e5e7eb;  
      --muted:#6b7280;  
      --shadow:0 6px 20px rgba(0,0,0,0.06);  
      --radius:14px;  
      --maxw:860px;  
    }  
    *{box-sizing:border-box;margin:0;padding:0}  
    body{font-family:"Inter",system-ui,sans-serif;background:var(--bg);color:#111827;line-height:1.6;}  

    header{  
      position:sticky;top:0;z-index:50;background:#fff;border-bottom:1px solid var(--border);  
      padding:14px 20px;display:flex;justify-content:space-between;align-items:center;  
      box-shadow:0 2px 8px rgba(0,0,0,0.04);  
    }  
    header h1{font-size:20px;font-weight:700;color:var(--accent)}  
    header button{  
      padding:8px 16px;border:none;border-radius:8px;background:var(--accent);color:#fff;font-weight:600;cursor:pointer;  
      transition:background .25s;  
    }  
    header button:hover{background:var(--accent-hover);}  

    .container{max-width:var(--maxw);margin:22px auto;padding:0 18px;display:grid;gap:22px;}  
    .card{background:var(--card);border-radius:var(--radius);padding:20px;box-shadow:var(--shadow);}  

    /* Profile */  
    .profile-info h2{font-size:22px;font-weight:700;margin-bottom:8px;}  
    .profile-info p{color:var(--muted);font-size:14px;margin:2px 0;}  

    /* Form */  
    form label{display:block;margin-top:14px;font-weight:600;font-size:14px;}  
    form input, form textarea{  
      width:100%;margin-top:6px;padding:12px 14px;border-radius:10px;border:1px solid var(--border);font-size:14px;  
      background:#f9fafb;transition:border .2s;  
    }  
    form input:focus, form textarea:focus{border-color:var(--accent);outline:none;}  
    form textarea{min-height:90px;resize:vertical;}  
    form button{  
      margin-top:18px;padding:12px 18px;border:none;border-radius:10px;background:var(--accent);color:#fff;  
      font-weight:600;cursor:pointer;transition:background .25s;  
    }  
    form button:hover{background:var(--accent-hover);}  
    .msg{margin-top:8px;font-size:13px;color:var(--muted)}  

    /* Posts */  
    .posts{display:grid;gap:20px;}  
    .post{padding:18px;border:1px solid var(--border);border-radius:12px;background:#fff;box-shadow:var(--shadow);transition:transform .2s;}  
    .post:hover{transform:translateY(-2px);}  
    .post-header{display:flex;align-items:center;gap:10px;margin-bottom:8px;}  
    .post-header img{width:40px;height:40px;border-radius:50%;object-fit:cover;}  
    .post-header .name{font-weight:600;font-size:15px;}  
    .post-header .username{font-size:13px;color:var(--muted);}  
    .post .caption{font-size:15px;margin-bottom:10px;}  
    .post img.post-img{max-width:100%;border-radius:10px;margin:8px 0;object-fit:cover;}  
    .post .prompt{background:#f9fafb;border:1px solid var(--border);padding:10px;border-radius:8px;font-family:ui-monospace,monospace;font-size:13px;position:relative;}  
    .copy-btn{position:absolute;top:6px;right:6px;background:var(--accent);color:#fff;border:none;padding:4px 8px;border-radius:6px;font-size:12px;cursor:pointer;transition:background .25s;}  
    .copy-btn:hover{background:var(--accent-hover);}  

    .actions{display:flex;gap:10px;margin-top:10px;}  
    .actions button{flex:1;padding:10px;border:none;border-radius:8px;cursor:pointer;font-size:14px;font-weight:500;transition:background .25s;}  
    .share-btn{background:#f3f4f6;color:#111;}  
    .share-btn:hover{background:#e5e7eb;}  
    .delete-btn{background:#ef4444;color:#fff;}  
    .delete-btn:hover{background:#b91c1c;}  

    .empty{padding:26px;text-align:center;color:var(--muted)}  

    /* Modal */  
    .modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.55);display:none;justify-content:center;align-items:center;z-index:100;}  
    .modal-content{background:#fff;width:92%;max-width:740px;max-height:80vh;overflow-y:auto;border-radius:14px;box-shadow:var(--shadow);padding:22px;position:relative;animation:fadeIn .3s ease;}  
    @keyframes fadeIn{from{opacity:0;transform:scale(.95);}to{opacity:1;transform:scale(1);}}  
    .modal-content h2{margin-bottom:15px;color:var(--accent)}  
    .close-btn{position:absolute;top:12px;right:16px;font-size:22px;font-weight:bold;cursor:pointer;color:#666;}  
    .close-btn:hover{color:#000;}  

    /* Saved Btn */  
    .saved-wrapper{display:flex;justify-content:flex-end;margin-bottom:10px;}  
    #savedBtn{background:#10b981;color:#fff;padding:10px 18px;border-radius:10px;border:none;font-weight:600;cursor:pointer;transition:background .25s;}  
    #savedBtn:hover{background:#059669;}  
  </style>  
</head>  
<body>  
  <header>  
    <h1>Prompt-Scientist</h1>  
    <button id="logoutBtn">Logout</button>  
  </header>    

  <main class="container">  
    <!-- Profile -->  
    <section class="card profile-info">  
      <h2 id="userName">Loading...</h2>  
      <p><strong>Username:</strong> <span id="userUsername"></span></p>  
      <p><strong>Email:</strong> <span id="userEmail"></span></p>  
    </section>  

    <!-- New Post Form -->  
    <section class="card">  
      <h2>üìù ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</h2>  
      <p class="msg">üì∑ ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá <a href="https://postimages.org/" target="_blank">postimages.org</a> ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç Direct link ‡¶¶‡¶ø‡¶®‡•§</p>  
      <form id="postForm">  
        <label>Image URL  
          <input id="imageURL" type="url" placeholder="https://i.postimg.cc/..."/>  
        </label>  
        <label>Caption (optional)  
          <textarea id="caption" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶™‡¶∂‡¶® ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..."></textarea>  
        </label>  
        <label>Prompt (required)  
          <textarea id="prompt" required placeholder="AI image prompt ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..."></textarea>  
        </label>  
        <button type="submit">üöÄ Submit Post</button>  
      </form>  
    </section>  

    <!-- Saved Button -->  
    <div class="saved-wrapper">  
      <button id="savedBtn">üíæ Saved Posts</button>  
    </div>  

    <!-- My Posts -->  
    <section class="card">  
      <h2>üìå ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶™‡ßã‡¶∏‡ßç‡¶ü‡¶ó‡ßÅ‡¶≤‡ßã</h2>  
      <div id="myPosts" class="posts"></div>  
    </section>  
  </main>  

  <!-- Saved Modal -->  
  <div id="savedModal" class="modal">  
    <div class="modal-content">  
      <span class="close-btn" id="closeModal">&times;</span>  
      <h2>üíæ Saved Posts</h2>  
      <div id="savedPosts" class="posts"></div>  
    </div>  
  </div>  

  <script type="module">  
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";  
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";  
    import { getFirestore, collection, addDoc, getDocs, query, where, orderBy, serverTimestamp, doc, deleteDoc, getDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";  
  
    const firebaseConfig = {  
      apiKey: "AIzaSyDDgwI90DMBa25JOkNR2Oec32kfgIt5TNg",  
      authDomain: "prompt-scientist.firebaseapp.com",  
      projectId: "prompt-scientist",  
      storageBucket: "prompt-scientist.firebasestorage.app",  
      messagingSenderId: "240705146800",  
      appId: "1:240705146800:web:e7f05107761f4d3007d075"  
    };  
    const app = initializeApp(firebaseConfig);  
    const auth = getAuth(app);  
    const db = getFirestore(app);  
  
    const userName=document.getElementById("userName");  
    const userUsername=document.getElementById("userUsername");  
    const userEmail=document.getElementById("userEmail");  
    const postForm=document.getElementById("postForm");  
    const myPosts=document.getElementById("myPosts");  
    const logoutBtn=document.getElementById("logoutBtn");  
    const savedBtn=document.getElementById("savedBtn");  
    const savedModal=document.getElementById("savedModal");  
    const closeModal=document.getElementById("closeModal");  
    const savedPostsEl=document.getElementById("savedPosts");  

    let currentUser=null;  
    let userData=null;  

    // Auth  
    onAuthStateChanged(auth,async(u)=>{  
      if(!u){location.href="index.html";return;}  
      currentUser=u;  

      const userRef = doc(db, "users", u.uid);  
      const userSnap = await getDoc(userRef);  
      if(userSnap.exists()){  
        userData = userSnap.data();  
        userName.textContent = userData.name || "User";  
        userUsername.textContent = userData.username ? "@" + userData.username : "";  
        userEmail.textContent = userData.email || u.email;  
      } else {  
        userData = { name:"User", username:"", email:u.email };  
        userName.textContent = "User";  
        userEmail.textContent = u.email;  
      }  

      loadPosts();  
      loadSavedPosts();  
    });  

    logoutBtn.addEventListener("click",()=>signOut(auth));  

    // Modal  
    savedBtn.addEventListener("click",()=>{ savedModal.style.display="flex"; });  
    closeModal.addEventListener("click",()=>{ savedModal.style.display="none"; });  
    window.addEventListener("click",(e)=>{ if(e.target===savedModal){ savedModal.style.display="none"; } });  

    // Load My Posts  
    async function loadPosts(){  
      myPosts.innerHTML="‚è≥ Loading...";  
      const q=query(collection(db,"posts"),where("uid","==",currentUser.uid),orderBy("timestamp","desc"));  
      const snap=await getDocs(q);  
      if(snap.empty){myPosts.innerHTML='<div class="empty">‚ùå ‡¶Ü‡¶™‡¶®‡¶ø ‡¶è‡¶ñ‡¶®‡¶ì ‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßá‡¶®‡¶®‡¶ø‡•§</div>';return;}  
      myPosts.innerHTML="";  
      snap.forEach(docSnap=>{ renderPost(docSnap,myPosts,true); });  
    }  

    // New Post  
    postForm.addEventListener("submit",async e=>{  
      e.preventDefault();  
      const imageURL=document.getElementById("imageURL").value.trim();  
      const caption=document.getElementById("caption").value.trim();  
      const prompt=document.getElementById("prompt").value.trim();  
      if(!prompt){alert("‚ö†Ô∏è Prompt is required");return;}  

      const settingsRef = doc(db, "settings", "global");  
      const settingsSnap = await getDoc(settingsRef);  
      let autoApprove = false;  
      if (settingsSnap.exists()) { autoApprove = settingsSnap.data().autoApprove === true; }  

      await addDoc(collection(db,"posts"),{  
        uid: currentUser.uid,  
        name: userData?.name || "",  
        username: userData?.username || "",  
        email: userData?.email || currentUser.email,  
        imageURL, caption, prompt,  
        timestamp: serverTimestamp(),  
        approved: autoApprove  
      });  

      alert("‚úÖ Post submitted! Pending admin approval.");  
      postForm.reset();  
      loadPosts();  
    });  

    // Delete Post  
    async function deletePost(id){  
      if(confirm("‚ö†Ô∏è ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?")){  
        await deleteDoc(doc(db,"posts",id));  
        loadPosts();  
      }  
    }  

    // Saved Posts  
    function loadSavedPosts(){  
      const q=collection(db,"users",currentUser.uid,"saved");  
      onSnapshot(q,(snap)=>{  
        if(snap.empty){savedPostsEl.innerHTML='<div class="empty">‚ùå ‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡¶®‡¶ø‡•§</div>';return;}  
        savedPostsEl.innerHTML="";  
        snap.forEach(docSnap=>{ renderPost(docSnap,savedPostsEl,false); });  
      });  
    }  

    // Render Post  
    function renderPost(docSnap,container,isMyPost){  
      const d=docSnap.data();  
      const div=document.createElement("div");  
      div.className="post";  
      div.innerHTML=`  
        <div class="post-header">  
          <img src="https://ui-avatars.com/api/?name=${encodeURIComponent(d.name||"U")}" alt="avatar">  
          <div>  
            <div class="name">${d.name||"User"}</div>  
            ${d.username?`<div class="username">@${d.username}</div>`:""}  
          </div>  
        </div>  
        <p class="caption">${d.caption||""}</p>  
        ${d.imageURL?`<img class="post-img" src="${d.imageURL}" alt="post">`:""}  
        <div class="prompt">${d.prompt}<button class="copy-btn">Copy</button></div>  
        <div class="actions">  
          <button class="share-btn">üîó Share</button>  
          ${isMyPost?`<button class="delete-btn" data-id="${docSnap.id}">üóë Delete</button>`:""}  
        </div>  
        <p class="msg">${d.approved?"‚úÖ Approved":"‚è≥ Pending approval"}</p>  
      `;  

      div.querySelector(".copy-btn").addEventListener("click",()=>{navigator.clipboard.writeText(d.prompt);alert("üìã Prompt copied!");});  
      div.querySelector(".share-btn").addEventListener("click",()=>{navigator.clipboard.writeText(location.origin+"/post/"+docSnap.id);alert("üîó Link copied!");});  
      if(isMyPost){  
        div.querySelector("[data-id]").addEventListener("click",()=>deletePost(docSnap.id));  
      }  
      container.appendChild(div);  
    }  
  </script>  
</body>  
  </html>
