<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Prompt Scientist â€” Profile</title>
<style>
:root{
  --bg:linear-gradient(135deg,#e0e7ff,#f9fafb);
  --card:rgba(255,255,255,0.75);
  --accent:#2563eb;
  --accent-hover:#1e40af;
  --border:rgba(255,255,255,0.4);
  --muted:#6b7280;
  --shadow:0 8px 28px rgba(37,99,235,0.15);
  --radius:18px;
  --maxw:880px;
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:"Inter",system-ui,Roboto,"Noto Sans",sans-serif;
  background:var(--bg);
  color:#111827;
  -webkit-font-smoothing:antialiased;
  min-height:100vh;
}

/* Header */
header{
  position:fixed;top:0;left:0;right:0;
  z-index:100;
  backdrop-filter:blur(12px);
  background:rgba(255,255,255,0.7);
  border-bottom:1px solid var(--border);
  padding:14px 22px;
  display:flex;justify-content:space-between;align-items:center;
  box-shadow:0 2px 10px rgba(0,0,0,0.04);
}
header h1{
  font-size:22px;
  font-weight:700;
  color:var(--accent);
}
header a{
  color:var(--accent);
  font-weight:600;
  text-decoration:none;
  font-size:15px;
  transition:color .2s;
}
header a:hover{color:var(--accent-hover);}

/* Layout */
.container{
  max-width:var(--maxw);
  margin:110px auto 60px;
  padding:0 20px;
  display:grid;
  gap:28px;
}

/* Glass Card */
.card, .profile-info{
  background:var(--card);
  backdrop-filter:blur(16px);
  border:1px solid var(--border);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:26px;
}

/* Profile */
.profile-info h2{
  font-size:22px;
  font-weight:700;
  margin-bottom:8px;
}
.profile-info p{
  color:var(--muted);
  font-size:14px;
  margin:4px 0;
}
.profile-buttons{
  margin-top:18px;
  display:flex;
  gap:12px;
}
button{
  cursor:pointer;
  transition:all .25s ease;
}
.manage-btn, .logout-btn{
  padding:10px 18px;
  border:none;
  border-radius:10px;
  font-weight:600;
  font-size:14px;
}
.manage-btn{
  background:linear-gradient(135deg,#2563eb,#1e40af);
  color:#fff;
}
.manage-btn:hover{
  transform:translateY(-2px);
  box-shadow:0 6px 14px rgba(37,99,235,0.35);
}
.logout-btn{
  background:#ef4444;
  color:#fff;
}
.logout-btn:hover{background:#b91c1c;}

/* Post Form */
form{display:flex;flex-direction:column;}
form h2{font-size:18px;font-weight:700;margin-bottom:8px;}
form .note{font-size:13px;color:var(--muted);margin-bottom:14px;}
form .note a{color:var(--accent);font-weight:600;text-decoration:none;}
form label{font-weight:600;margin-top:10px;font-size:14px;}
form input,form textarea{
  width:100%;margin-top:6px;padding:12px;border-radius:10px;
  border:1px solid var(--border);font-size:14px;background:rgba(255,255,255,0.85);
}
form textarea{min-height:90px;resize:vertical;}
form button{
  margin-top:18px;padding:12px 18px;border:none;border-radius:10px;
  background:linear-gradient(135deg,#2563eb,#1e40af);color:#fff;font-weight:600;
}
form button:hover{transform:translateY(-2px);box-shadow:0 6px 14px rgba(30,64,175,0.3);}

/* Posts */
.posts{display:grid;gap:18px;}
.post{
  background:rgba(255,255,255,0.85);
  border:1px solid var(--border);
  border-radius:14px;
  padding:16px;
  display:flex;
  flex-direction:column;
  gap:10px;
  box-shadow:var(--shadow);
}
.post h3{font-size:16px;font-weight:600;}
.post img{max-width:100%;border-radius:10px;object-fit:cover}
.post .prompt{
  background:rgba(249,250,251,0.9);
  border:1px solid var(--border);
  padding:10px;
  border-radius:8px;
  font-family:ui-monospace,monospace;
  font-size:13px;
}
.post button{
  align-self:flex-end;
  padding:6px 12px;
  font-size:13px;
  background:#ef4444;
  color:#fff;
  border:none;
  border-radius:8px;
}
.post button:hover{background:#b91c1c;}
.empty{padding:28px;text-align:center;color:var(--muted)}

.loader{
  width:32px;height:32px;
  border:4px solid #ccc;
  border-top:4px solid var(--accent);
  border-radius:50%;
  margin:20px auto;
  animation:spin 1s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}

/* Popup Modal */
.popup-bg{
  position:fixed;inset:0;display:none;
  align-items:center;justify-content:center;
  background:rgba(0,0,0,0.4);
  backdrop-filter:blur(4px);
  z-index:999;
}
.popup{
  background:#fff;
  padding:24px 28px;
  border-radius:14px;
  box-shadow:0 8px 28px rgba(0,0,0,0.15);
  text-align:center;
  max-width:320px;
  width:90%;
  animation:fadeIn .25s ease;
}
.popup h3{font-size:18px;margin-bottom:12px;}
.popup p{font-size:14px;color:#444;margin-bottom:20px;}
.popup .actions{display:flex;justify-content:center;gap:10px;}
.popup button{
  padding:8px 16px;border:none;border-radius:8px;font-weight:600;
}
.popup .yes{background:#2563eb;color:#fff;}
.popup .no{background:#e5e7eb;}
@keyframes fadeIn{from{opacity:0;transform:scale(.9)}to{opacity:1;transform:scale(1)}}
</style>
</head>
<body>

<header>
  <h1>Prompt Scientist</h1>
  <a href="#profile">My Profile</a>
</header>

<main class="container">
  <section id="profile" class="profile-info">
    <h2 id="userName">Loading...</h2>
    <p><strong>Username:</strong> <span id="userUsername"></span></p>
    <p><strong>Email:</strong> <span id="userEmail"></span></p>
    <div class="profile-buttons">
      <button id="manageAccountBtn" class="manage-btn">Manage Account</button>
      <button id="logoutBtn" class="logout-btn">Logout</button>
    </div>
  </section>

  <section class="card">
    <form id="postForm">
      <h2>Create a New Post</h2>
      <p class="note">Use <a href="https://postimages.org/" target="_blank">postimages.org</a> to upload your image and paste the <strong>Direct link</strong> below.</p>
      <label>Image URL
        <input id="imageURL" type="url" placeholder="https://i.postimg.cc/..."/>
      </label>
      <label>Caption (optional)
        <textarea id="caption" placeholder="Write your caption..."></textarea>
      </label>
      <label>Prompt (required)
        <textarea id="prompt" required placeholder="Write your AI prompt..."></textarea>
      </label>
      <button type="submit">Submit Post</button>
    </form>
  </section>

  <section class="card">
    <h2>My Posts</h2>
    <div id="myPosts" class="posts"><div class="loader"></div></div>
  </section>
</main>

<!-- Popup Modal -->
<div class="popup-bg" id="popupBg">
  <div class="popup" id="popupBox">
    <h3 id="popupTitle">Message</h3>
    <p id="popupMsg"></p>
    <div class="actions" id="popupActions"></div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
import { getFirestore, collection, addDoc, query, where, orderBy, onSnapshot, serverTimestamp, doc, deleteDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDDgwI90DMBa25JOkNR2Oec32kfgIt5TNg",
  authDomain: "prompt-scientist.firebaseapp.com",
  projectId: "prompt-scientist",
  storageBucket: "prompt-scientist.firebasestorage.app",
  messagingSenderId: "240705146800",
  appId: "1:240705146800:web:e7f05107761f4d3007d075"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const userName=document.getElementById("userName");
const userUsername=document.getElementById("userUsername");
const userEmail=document.getElementById("userEmail");
const postForm=document.getElementById("postForm");
const myPosts=document.getElementById("myPosts");
const logoutBtn=document.getElementById("logoutBtn");
const manageAccountBtn=document.getElementById("manageAccountBtn");

// Popup System
function showPopup(title,msg,buttons=[{text:"OK",action:()=>hidePopup()}]){
  const bg=document.getElementById("popupBg");
  const t=document.getElementById("popupTitle");
  const m=document.getElementById("popupMsg");
  const a=document.getElementById("popupActions");
  t.textContent=title;m.textContent=msg;a.innerHTML="";
  buttons.forEach(b=>{
    const btn=document.createElement("button");
    btn.textContent=b.text;
    btn.className=b.type||"no";
    btn.onclick=()=>{b.action();};
    a.appendChild(btn);
  });
  bg.style.display="flex";
}
function hidePopup(){document.getElementById("popupBg").style.display="none";}

let currentUser=null,userData=null;

// Auth
onAuthStateChanged(auth,async(u)=>{
  if(!u){location.href="index.html";return;}
  currentUser=u;
  const snap=await getDoc(doc(db,"users",u.uid));
  userData=snap.exists()?snap.data():{name:"User",username:"",email:u.email};
  userName.textContent=userData.name||"User";
  userUsername.textContent=userData.username?`@${userData.username}`:"";
  userEmail.textContent=userData.email||u.email;
  loadPostsRealtime();
});

manageAccountBtn.addEventListener("click",()=>location.href="account-manage.html");
logoutBtn.addEventListener("click",()=>{
  showPopup("Logout","Are you sure you want to logout?",[
    {text:"Yes",type:"yes",action:()=>{hidePopup();signOut(auth);}},
    {text:"No",type:"no",action:hidePopup}
  ]);
});

// Realtime Posts
function loadPostsRealtime(){
  const q=query(collection(db,"posts"),where("uid","==",auth.currentUser.uid),orderBy("timestamp","desc"));
  onSnapshot(q,(snap)=>{
    if(snap.empty){myPosts.innerHTML='<div class="empty">No posts yet.</div>';return;}
    myPosts.innerHTML="";
    snap.forEach(docSnap=>{
      const d=docSnap.data();
      const div=document.createElement("div");
      div.className="post";
      div.innerHTML=`
        <h3>${d.caption||"(No caption)"}</h3>
        ${d.imageURL?`<img src="${d.imageURL}" alt="post">`:""}
        <div class="prompt">${d.prompt}</div>
        <button data-id="${docSnap.id}">Delete</button>
        <p class="msg">${d.approved?"Approved":"Pending approval"}</p>
      `;
      div.querySelector("button").addEventListener("click",()=>deletePost(docSnap.id));
      myPosts.appendChild(div);
    });
  });
}

// New Post
postForm.addEventListener("submit",async e=>{
  e.preventDefault();
  const imageURL=document.getElementById("imageURL").value.trim();
  const caption=document.getElementById("caption").value.trim();
  const prompt=document.getElementById("prompt").value.trim();
  if(!prompt){showPopup("Error","Prompt is required.");return;}
  const settingsSnap=await getDoc(doc(db,"settings","global"));
  const autoApprove=settingsSnap.exists()&&settingsSnap.data().autoApprove===true;
  await addDoc(collection(db,"posts"),{
    uid:auth.currentUser.uid,
    name:userData?.name||"",
    username:userData?.username||"",
    email:userData?.email||auth.currentUser.email,
    imageURL,caption,prompt,
    timestamp:serverTimestamp(),
    approved:autoApprove
  });
  postForm.reset();
  showPopup("Success","Your post has been submitted successfully.");
});

// Delete
async function deletePost(id){
  showPopup("Delete","Do you really want to delete this post?",[
    {text:"Yes",type:"yes",action:async()=>{await deleteDoc(doc(db,"posts",id));hidePopup();}},
    {text:"No",type:"no",action:hidePopup}
  ]);
}
</script>
</body>
</html>
