<!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Prompt-Scientist — Feed</title>
  <style>
    :root{
      --bg:#f3f4f6;
      --card:#fff;
      --muted:#6b7280;
      --accent:#7c3aed; /* purple */
      --brand:#7c3aed;
      --radius:12px;
      --shadow:0 6px 18px rgba(16,24,40,0.08);
      --maxw:900px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,'Noto Sans',Arial;background:var(--bg);color:#0f172a;line-height:1.5}

    /* --- Topbar --- */
    .topbar{position:sticky;top:0;z-index:100;background:#fff;max-width:var(--maxw);
      margin:0 auto;padding:14px 20px;display:flex;align-items:center;justify-content:space-between;
      transition:transform 0.4s ease, opacity 0.4s ease;border-bottom:1px solid #e5e7eb;}
    .topbar.hide{transform:translateY(-100%);opacity:0}
    .brand h1{font-size:28px;margin:0;font-weight:800;color:var(--brand);}

    .profile-btn{width:44px;height:44px;border-radius:50%;background:#fff;border:1px solid #e6eefc;
      display:grid;place-items:center;cursor:pointer;box-shadow:0 4px 10px rgba(16,24,40,0.06);font-size:20px;transition:transform 0.2s}
    .profile-btn:hover{transform:scale(1.05)}

    /* --- Search Box --- */
    .search-container{background:#fff;padding:16px;max-width:var(--maxw);margin:0 auto;border-bottom:1px solid #e5e7eb;}
    .search-box{width:100%;position:relative;}
    .search-box input{width:100%;padding:12px 16px;border:1px solid #d1d5db;border-radius:10px;font-size:15px;
      transition:all 0.3s ease;box-shadow:0 2px 6px rgba(0,0,0,0.05);}
    .search-box input:focus{outline:none;border-color:var(--accent);box-shadow:0 4px 12px rgba(124,58,237,0.2);}

    .container{max-width:var(--maxw);margin:0 auto;padding:0 18px 80px;}
    .feed{margin-top:14px;display:flex;flex-direction:column;gap:16px}
    .card{background:var(--card);border-radius:var(--radius);padding:14px;border:1px solid #eef2ff;box-shadow:var(--shadow)}

    .post-header{display:flex;gap:12px;align-items:center}
    .uicon{width:44px;height:44px;border-radius:50%;display:grid;place-items:center;font-weight:700;color:#fff;font-size:18px}
    .meta{display:flex;flex-direction:column}
    .username{font-weight:700}
    .time{font-size:12px;color:var(--muted)}

    .caption{margin-top:10px;white-space:pre-wrap;line-height:1.45}
    .post-image{width:100%;max-height:520px;object-fit:cover;margin-top:12px;border-radius:10px}

    .prompt-block{margin-top:12px;padding:10px;border-radius:10px;background:#f9fafb;border:1px solid #eef2ff;
      display:flex;justify-content:space-between;gap:12px;align-items:center}
    .prompt-text{font-family:ui-monospace, monospace;font-size:13px;color:#0f172a;overflow:hidden;text-overflow:ellipsis}
    .btn-copy{padding:8px 12px;border-radius:8px;border:none;background:var(--accent);color:#fff;cursor:pointer;transition:background 0.2s;}
    .btn-copy:hover{background:#6d28d9}

    /* --- Reactions --- */
    .actions{display:flex;gap:10px;align-items:center;margin-top:12px;flex-wrap:nowrap}
    .btn-react{display:inline-flex;align-items:center;gap:6px;padding:8px 14px;
      border-radius:20px;border:1px solid #e5e7eb;background:#fff;cursor:pointer;font-size:15px;
      transition:all 0.2s;box-shadow:0 2px 5px rgba(0,0,0,0.04);}
    .btn-react:hover{background:#f3f0ff;border-color:#d8b4fe}
    .btn-react.active{background:#ede9fe;border-color:#c4b5fd;color:#5b21b6}
    .btn-react .count{font-weight:600;font-size:14px}

    .ad-card{padding:0;border:1px solid #e5e7eb;overflow:hidden;position:relative;border-radius:var(--radius);box-shadow:var(--shadow)}
    .ad-card img{width:100%;height:auto;display:block}
    .ad-card .sponsored{position:absolute;top:6px;left:8px;background:#00000099;color:#fff;font-size:12px;padding:2px 6px;border-radius:6px;}

    .loading{padding:18px;text-align:center;color:var(--muted)}
    .empty{padding:28px;text-align:center;color:var(--muted)}

    @media(max-width:600px){
      .brand h1{font-size:22px}
    }
  </style>
</head>
<body>
  <!-- Topbar -->
  <header id="topbar" class="topbar">
    <div class="brand"><h1>Prompt-Scientist</h1></div>
    <button id="profileBtn" class="profile-btn" title="Profile" aria-label="Profile">👤</button>
  </header>

  <!-- Search under topbar -->
  <div class="search-container">
    <div class="search-box">
      <input id="searchInput" type="text" placeholder="🔍 Search prompts, users...">
    </div>
  </div>

  <main class="container">
    <section id="feed" class="feed" aria-live="polite"></section>
    <div id="loading" class="loading">Loading posts…</div>
    <div id="endMsg" class="empty" style="display:none">No more posts</div>
  </main>

  <!-- Script (same as before, only UI updated for reactions/search) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { getFirestore, collection, query, where, getDocs, doc, updateDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    const firebaseConfig={ /* same config as before */ };
    const app=initializeApp(firebaseConfig);
    const auth=getAuth(app);
    const db=getFirestore(app);

    const feedEl=document.getElementById('feed');
    const loadingEl=document.getElementById('loading');
    const endMsgEl=document.getElementById('endMsg');
    const profileBtn=document.getElementById('profileBtn');
    const topbar=document.getElementById('topbar');
    const searchInput=document.getElementById('searchInput');

    let posts=[];let ads=[];let user=null;let currentIndex=0;
    const PAGE_SIZE=6;const userCache={};

    async function loadUserName(uid){/* same as before */}
    function randomColor(){/* same as before */}
    function getLocalAuth(){/* same as before */}
    function ensureAuth(){/* same as before */}
    const escapeHtml=(s='')=>String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');
    const timeAgo=ts=>{/* same as before */}
    function shuffle(a){/* same as before */}
    async function loadData(){/* same as before */}
    function renderNext(){/* same as before */}
    function renderPost(p){/* same as before */}
    function renderReactionBtn(type,emoji,count,myReact){/* same as before */}
    function renderAd(a){/* same as before */}
    function updateReactionUI(postEl, type){/* same as before */}

    feedEl.addEventListener('click',async e=>{/* same as before */});
    searchInput.addEventListener('input',()=>{/* same as before */});
    window.addEventListener('scroll',()=>{/* same as before */});
    profileBtn.addEventListener('click',()=>location.href='profile.html');
    let lastY=window.scrollY;
    window.addEventListener('scroll',()=>{/* same as before */});

    if(ensureAuth())loadData();
  </script>
</body>
</html>
