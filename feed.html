<!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Prompt-Scientist ‚Äî Feed</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Share+Tech+Mono&display=swap" rel="stylesheet">
  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">

  <!-- Theme color -->
  <meta name="theme-color" content="#2563eb">

  <!-- Favicon / Home screen icon -->
  <link rel="icon" type="image/png" href="prompticon.png" sizes="192x192">
  <link rel="apple-touch-icon" href="prompticon.png">
    <!-- Description -->
  <meta name="description" content="Prompt-Scientist is an AI image prompt sharing platform. Explore, share, and discover creative prompts for Gemini, MidJourney, Stable Diffusion, and more.">

  <!-- Keywords -->
  <meta name="keywords" content="AI prompts, Gemini, MidJourney, Stable Diffusion, AI art, creative prompts, prompt sharing, AI image generation">

  <!-- Canonical -->
  <link rel="canonical" href="https://www.prompt-sci.pro/feed.html">

  <!-- Open Graph (Facebook, LinkedIn etc.) -->
  <meta property="og:title" content="Prompt-Scientist ‚Äî Share & Explore AI Prompts">
  <meta property="og:description" content="Discover trending AI image prompts shared by the community.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://www.prompt-sci.pro/feed.html">
  <meta property="og:image" content="https://www.prompt-sci.pro/prompticon.png">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Prompt-Scientist ‚Äî AI Prompt Sharing Platform">
  <meta name="twitter:description" content="Explore creative AI prompts for generating unique images.">
  <meta name="twitter:image" content="https://www.prompt-sci.pro/prompticon.png">
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
   <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "Prompt-Scientist",
  "url": "https://www.prompt-sci.pro/",
  "description": "Prompt-Scientist is an AI image prompt sharing platform where users can share and explore AI prompts for Gemini, MidJourney, Stable Diffusion, and other AI tools.",
  "potentialAction": {
    "@type": "SearchAction",
    "target": "https://www.prompt-sci.pro/feed.html?search={search_term_string}",
    "query-input": "required name=search_term_string"
  }
}
   </script>
  <style>
    :root{
      --maxw: 920px;
      --radius: 12px;
      --muted: #6b7280;
      --accent-1: #2163ff;   /* blue */
      --accent-2: #7c3aed;   /* purple */
      --bg: #f6f8fb;
      --card: #ffffff;
      --glass: rgba(255,255,255,0.6);
      --elev: 0 8px 22px rgba(18,24,40,0.06);
    }
    /* dark theme vars (applied with body.dark) */
    body.dark {
      --bg: #0b0f14;
      --card: rgba(14,18,24,0.7);
      --glass: rgba(20,25,32,0.5);
      --elev: 0 12px 30px rgba(2,6,23,0.6);
      --muted: #9aa6bb;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:
        radial-gradient(1200px 400px at 10% 10%, rgba(124,58,237,0.06), transparent 12%),
        radial-gradient(1000px 300px at 90% 90%, rgba(33,99,255,0.04), transparent 12%),
        var(--bg);
      color: #0b1220;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      transition: background .25s ease, color .2s ease;
    }
    body.dark{color:#e6eef8}

    /* Layout container */
    .wrap{
      max-width:var(--maxw);
      margin:20px auto;
      padding:18px;
    }

    /* Topbar */
    .topbar{
      position:sticky; top:10px; z-index:60;
      display:flex; gap:12px; align-items:center;
      padding:12px; border-radius:14px;
      background: linear-gradient(180deg, var(--glass), rgba(255,255,255,0.02));
      box-shadow:var(--elev);
      border:1px solid rgba(0,0,0,0.04);
      backdrop-filter: blur(8px) saturate(1.05);
      transition: transform .35s ease, opacity .35s ease;
    }
    body.dark .topbar{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.03);
    }
    .brand{
      display:flex; gap:10px; align-items:center;
    }
    .logo{
      width:44px;height:44px;border-radius:10px;
      display:grid;place-items:center;font-weight:800;
      background: linear-gradient(135deg,var(--accent-1),var(--accent-2));
      color:#fff;box-shadow:0 6px 18px rgba(124,58,237,0.12);
      font-family:"Inter"; font-size:16px;
    }
    .brand h1{font-size:18px;margin:0;letter-spacing:-0.2px}
    .search-box{flex:1;min-width:140px}
    .search-box input{
      width:100%;padding:9px 12px;border-radius:10px;border:1px solid rgba(11,18,28,0.06);
      background:rgba(255,255,255,0.9);font-size:14px;color:inherit;
      outline:none;transition:box-shadow .18s ease, transform .12s ease;
    }
    body.dark .search-box input{background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03)}
    .search-box input:focus{box-shadow:0 6px 22px rgba(33,99,255,0.08); transform:translateY(-1px)}
    .controls{display:flex;gap:8px;align-items:center}
    .icon-btn{
      height:42px;padding:0 12px;border-radius:10px;border:none;background:transparent;color:inherit;
      display:inline-flex;align-items:center;gap:8px;cursor:pointer;font-weight:600;
      transition:transform .12s, box-shadow .12s;
    }
    .icon-btn:hover{transform:translateY(-3px); box-shadow: 0 8px 20px rgba(33,99,255,0.06)}
    .mode-toggle{display:inline-flex;align-items:center;gap:8px;padding:8px;border-radius:10px;background:linear-gradient(90deg, rgba(33,99,255,0.06), rgba(124,58,237,0.04));border:1px solid rgba(11,18,28,0.04)}
    .profile-btn{width:42px;height:42px;border-radius:10px;border:1px solid rgba(11,18,28,0.06);display:grid;place-items:center;background:transparent;color:var(--accent-1);font-size:18px}

    /* Feed */
    .feed{margin-top:18px;display:flex;flex-direction:column;gap:16px}
    .card{
  background:var(--card);
  border-radius:var(--radius);
  padding:14px;
  border:1px solid rgba(11,18,28,0.05);
  box-shadow:var(--elev);
  transition: transform .22s ease, box-shadow .22s ease;
  overflow:hidden;
  will-change: transform; /* ‚úÖ ‡¶®‡¶§‡ßÅ‡¶® ‡¶≤‡¶æ‡¶á‡¶® */
    }
    body.dark .card{ border:1px solid rgba(255,255,255,0.03) }

    .card:hover{ transform: translateY(-6px); box-shadow: 0 22px 46px rgba(11,18,28,0.12); }

    .post-header{display:flex;gap:12px;align-items:center}
    .uicon{
      width:48px;height:48px;border-radius:10px;display:grid;place-items:center;font-weight:800;color:#fff;
      font-size:18px;
      background:linear-gradient(135deg,var(--accent-1),var(--accent-2));
      box-shadow: 0 8px 30px rgba(33,99,255,0.08);
    }
    .meta{display:flex;flex-direction:column}
    .username{font-weight:700;font-size:15px;color:inherit}
    .time{font-size:12px;color:var(--muted)}

    .caption{margin-top:12px;line-height:1.5;font-size:15px;color:inherit}
    .post-image{width:100%;max-height:480px;object-fit:cover;border-radius:10px;margin-top:12px;display:block;box-shadow:0 8px 30px rgba(11,18,28,0.06)}

    /* prompt block */
    .prompt-block{
      margin-top:12px;padding:10px;border-radius:10px;display:flex;align-items:center;gap:12px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:1px solid rgba(11,18,28,0.04);
      font-family: "Share Tech Mono", monospace;
      font-size:13px;color: #0b1220;
    }
    body.dark .prompt-block{ color: #cfe8ff }
    .prompt-text{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .btn-copy{padding:8px 12px;border-radius:8px;border:none;background:linear-gradient(90deg,var(--accent-1),var(--accent-2));color:#fff;cursor:pointer;font-weight:700;letter-spacing:0.2px}

    /* actions */
    .actions{display:flex;gap:8px;align-items:center;margin-top:12px;flex-wrap:wrap}
    .btn-react{
      display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:20px;border:1px solid rgba(11,18,28,0.05);
      background:transparent;cursor:pointer;font-weight:600;
    }
    .btn-react.active{background:linear-gradient(90deg,var(--accent-1),var(--accent-2));color:#fff;border-color:transparent;box-shadow:0 10px 28px rgba(124,58,237,0.08)}
/* dark mode fix for reactions */
body.dark .btn-react,
body.dark .btn-react .count {
  color: #fff;
}
    /* ad */
    .ad-card{padding:0;border-radius:10px;overflow:hidden;border:1px solid rgba(11,18,28,0.04)}
    .ad-card img{width:100%;display:block;height:auto}

    /* states */
    .loading, .empty{padding:18px;text-align:center;color:var(--muted);font-size:14px}

    /* responsive */
    @media(max-width:760px){
      .wrap{padding:12px}
      .topbar{flex-direction:column;align-items:stretch;gap:10px}
      .brand h1{font-size:16px}
    }
  </style>
</head>
<body class="">
  <noscript>
  <p>Prompt-Scientist is a community where you can share and explore AI image prompts.</p>
  </noscript>
  <div class="wrap">
    <header class="topbar" id="topbar">
      <div class="brand">
        <div class="logo">PS</div>
        <div>
          <h1 style="margin:0;font-size:16px">Prompt-Scientist</h1>
          <div style="font-size:12px;color:var(--muted);margin-top:2px">Feed ‚Ä¢ Latest prompts & examples</div>
        </div>
      </div>
      <div class="search-box">
        <input id="searchInput" placeholder="Search by text or author..." type="search" />
      </div>
      <div class="controls">
        <button class="icon-btn mode-toggle" id="modeBtn" title="Toggle theme">üåó</button>
        <button class="icon-btn profile-btn" id="profileBtn" title="Profile">üë§</button>
      </div>
    </header>

    <main>
      <section id="feed" class="feed" aria-live="polite"></section>
      <div id="loading" class="loading">Loading posts‚Ä¶</div>
      <div id="endMsg" class="empty" style="display:none">No more posts</div>
    </main>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { 
  getFirestore, collection, query, where, onSnapshot, doc, getDoc, updateDoc 
} from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
    const firebaseConfig = {
      apiKey:"AIzaSyDDgwI90DMBa25JOkNR2Oec32kfgIt5TNg",
      authDomain:"prompt-scientist.firebaseapp.com",
      projectId:"prompt-scientist",
      storageBucket:"prompt-scientist.firebasestorage.app",
      messagingSenderId:"240705146800",
      appId:"1:240705146800:web:e7f05107761f4d3007d075"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db   = getFirestore(app);

    // ----------- Dynamic SEO Functions ----------- //
function updateSEOMeta(post) {
  const title = `${post.caption?.slice(0, 60) || "AI Prompt"} | Prompt-Scientist`;
  const desc = post.prompt?.slice(0, 160) || "Explore creative AI prompts on Prompt-Scientist.";
  const image = post.imageURL || "https://www.prompt-sci.pro/prompticon.png";
  const url   = `${window.location.origin}${window.location.pathname}?id=${post.id}`;

  document.title = title;

  setMeta("description", desc);
  setMeta("keywords", "AI prompt, MidJourney, Stable Diffusion, AI art, creative prompts");
  setOg("og:title", title);
  setOg("og:description", desc);
  setOg("og:image", image);
  setOg("og:url", url);
  setMeta("twitter:title", title);
  setMeta("twitter:description", desc);
  setMeta("twitter:image", image);

  // Canonical
  let canon = document.querySelector("link[rel='canonical']");
  if (!canon) {
    canon = document.createElement("link");
    canon.rel = "canonical";
    document.head.appendChild(canon);
  }
  canon.href = url;
}

function setMeta(name, content) {
  let tag = document.querySelector(`meta[name='${name}']`);
  if (!tag) {
    tag = document.createElement("meta");
    tag.name = name;
    document.head.appendChild(tag);
  }
  tag.content = content;
}
function setOg(property, content) {
  let tag = document.querySelector(`meta[property='${property}']`);
  if (!tag) {
    tag = document.createElement("meta");
    tag.setAttribute("property", property);
    document.head.appendChild(tag);
  }
  tag.content = content;
    }

    // ---------- DOM ----------
    const feedEl    = document.getElementById("feed");
    const loadingEl = document.getElementById("loading");
    const endMsgEl  = document.getElementById("endMsg");
    const profileBtn= document.getElementById("profileBtn");
    const topbar    = document.getElementById("topbar");
    const searchInput = document.getElementById("searchInput");
    const modeBtn     = document.getElementById("modeBtn");

    // ---------- State ----------
    let posts = [];
    let ads = [];
    let user = null;
    let currentIndex = 0;
    const PAGE_SIZE = 6;
    const userCache = {}; 
    let nextAdAfter = randomAdGap();

    // ---------- Helpers ----------
    const randomColor = ()=> ["#2563eb","#dc2626","#16a34a","#9333ea","#ea580c","#0d9488"][Math.floor(Math.random()*6)];
    const escapeHtml = (s="") => String(s).replace(/[&<>]/g, ch=> ({"&":"&amp;","<":"&lt;",">":"&gt;"}[ch]));
    const timeAgo = ts=>{
      try{
        const d = ts?.toDate ? ts.toDate() : new Date(ts);
        const sec = (Date.now() - d) / 1000;
        if(sec < 60) return `${Math.floor(sec)}s`;
        if(sec < 3600) return `${Math.floor(sec/60)}m`;
        if(sec < 86400) return `${Math.floor(sec/3600)}h`;
        return `${Math.floor(sec/86400)}d`;
      }catch{return "";}
    };
    function randomAdGap(){ return Math.floor(Math.random()*6) + 2; } // 2‚Äì7
function shuffleArray(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
    }
    // ---------- Load user names ----------
    async function loadUsersForPosts(uids){
      const toLoad = uids.filter(uid => uid && !userCache[uid]);
      await Promise.all(toLoad.map(async uid=>{
        try{
          const snap = await getDoc(doc(db, "users", uid));
          if(snap.exists()){
            const d = snap.data();
            userCache[uid] = d.name?.trim() || d.username?.trim() || "Unknown";
          }else userCache[uid] = "Unknown";
        }catch{ userCache[uid] = "Unknown"; }
      }));
    }

    // ---------- Load posts & ads ----------
    function subscribeToPosts(){
  loadingEl.style.display = "block";
  feedEl.innerHTML = "";
  endMsgEl.style.display = "none";

  const q = query(collection(db, "posts"), where("approved","==", true));

  // üîπ Ads ‡¶≤‡ßã‡¶°
  onSnapshot(collection(db, "ads"), (snapAds)=>{
    ads = snapAds.docs.map(d=>({id:d.id,...d.data()}));
  });

  // üîπ Posts ‡¶≤‡ßã‡¶°
  onSnapshot(q, async (snap)=>{
  let fetched = snap.docs.map(d=>({ id:d.id, ...d.data() }));

  if (posts.length === 0) {
    // ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡¶¨‡¶æ‡¶∞ shuffle ‡¶π‡¶¨‡ßá
    fetched = shuffleArray(fetched);

    const uids = Array.from(new Set(fetched.map(p=>p.uid).filter(Boolean)));
    await loadUsersForPosts(uids);

    posts = fetched.map(p=>({
      ...p,
      name: userCache[p.uid] || "Unknown",
      color: randomColor()
    }));

    // ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡¶¨‡¶æ‡¶∞ ‡¶™‡ßÅ‡¶∞‡ßã feed render ‡¶π‡¶¨‡ßá
    feedEl.innerHTML = "";
    currentIndex = 0;
    nextAdAfter = randomAdGap();
    renderNext();
    loadingEl.style.display="none";
  } else {
    // ‡¶™‡¶∞‡ßá‡¶∞‡¶¨‡¶æ‡¶∞ ‡¶∂‡ßÅ‡¶ß‡ßÅ update ‡¶π‡¶ì‡¶Ø‡¶º‡¶æ post replace ‡¶ï‡¶∞‡¶¨‡ßã
    snap.docChanges().forEach(change => {
      if (change.type === "modified") {
        const updated = { id: change.doc.id, ...change.doc.data() };
        const idx = posts.findIndex(p => p.id === updated.id);
        if (idx !== -1) {
          posts[idx] = { ...posts[idx], ...updated };
          const oldEl = feedEl.querySelector(`[data-id="${updated.id}"]`);
          if (oldEl) {
            oldEl.replaceWith(renderPost(posts[idx]));
          }
        }
      }
    });
  }
});
  }
    // ---------- Render ----------
    function renderNext(){
      if(currentIndex >= posts.length){
        endMsgEl.style.display="block"; return;
      }
      const frag = document.createDocumentFragment();
      const end = Math.min(currentIndex + PAGE_SIZE, posts.length);
      for(let i=currentIndex;i<end;i++){
        frag.appendChild(renderPost(posts[i]));
        if(ads.length && ( (i+1-currentIndex) % nextAdAfter === 0 )){
          frag.appendChild(renderAd(ads[Math.floor(Math.random()*ads.length)]));
          nextAdAfter = randomAdGap();
        }
      }
      feedEl.appendChild(frag);
      currentIndex=end;
    }

    function renderPost(p){
  const counts = {like:0,love:0,haha:0,angry:0,wow:0};
  Object.values(p.reactions||{}).forEach(r=>{ if(counts[r]!==undefined) counts[r]++; });

  const displayName = p.name || "Unknown";
  const initial = displayName[0]?.toUpperCase() || "U";

  const el = document.createElement("article");
  el.className="card post";
  el.dataset.id=p.id;
  el.innerHTML=`
    <div class="post-header">
      <div class="uicon" style="background:${p.color}">${escapeHtml(initial)}</div>
      <div class="meta">
        <div class="username">${escapeHtml(displayName)}</div>
        <div class="time">${timeAgo(p.timestamp)}</div>
      </div>
    </div>
    <div class="caption">${escapeHtml(p.caption||"")}</div>
    ${p.imageURL?`<img class="post-image" src="${escapeHtml(p.imageURL)}" loading="lazy">`:""}
    <div class="prompt-block">
      <div class="prompt-text" title="${escapeHtml(p.prompt||"")}">${escapeHtml(p.prompt||"")}</div>
      <button class="btn-copy" data-prompt="${escapeHtml(p.prompt||"")}">Copy</button>
    </div>
    <div class="actions">
      ${reactionBtn("like","üëç",counts.like)}
      ${reactionBtn("love","‚ù§Ô∏è",counts.love)}
      ${reactionBtn("haha","üòÇ",counts.haha)}
      ${reactionBtn("angry","üò°",counts.angry)}
      ${reactionBtn("wow","üòÆ",counts.wow)}
      <button class="btn-react btn-share" data-id="${p.id}">üîó Share</button>
    </div>
  `;
  return el;   // ‚úÖ ‡¶è‡¶ü‡¶æ ‡¶Ü‡¶≤‡¶æ‡¶¶‡¶æ ‡¶≤‡¶æ‡¶á‡¶®‡ßá ‡¶•‡¶æ‡¶ï‡¶¨‡ßá, innerHTML-‡¶è‡¶∞ ‡¶¨‡¶æ‡¶á‡¶∞‡ßá
}
    const reactionBtn=(t,e,c)=>`<button class="btn-react" data-type="${t}"><span>${e}</span><span class="count">${c}</span></button>`;
    function renderAd(a){
      const el=document.createElement("div");
      el.className="card ad-card";
      el.innerHTML=`<div style="padding:12px">
        <div style="color:var(--muted);font-size:12px;margin-bottom:6px">Sponsored</div>
        <a href="${escapeHtml(a.link||"#")}" target="_blank"><img src="${escapeHtml(a.imageURL||"")}"></a>
      </div>`;
      return el;
    }

    // ---------- Events ----------
    feedEl.addEventListener("click", async (ev) => {
  // --- Copy button ---
  const copyBtn = ev.target.closest(".btn-copy");
  if (copyBtn) {
    // ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶® ‚Äì dataset ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá‡¶ì fallback ‡¶®‡ßá‡¶¨‡ßá
    const text =
      copyBtn.getAttribute("data-prompt") ||
      copyBtn.previousElementSibling.textContent.trim();

    try {
      await navigator.clipboard.writeText(text);
      copyBtn.textContent = "Copied!";
    } catch (err) {
      // Clipboard ‡¶ï‡¶æ‡¶ú ‡¶®‡¶æ ‡¶ï‡¶∞‡¶≤‡ßá ‡¶´‡ßã‡¶≤‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï
      const ta = document.createElement("textarea");
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand("copy");
      document.body.removeChild(ta);
      copyBtn.textContent = "Copied!";
    }

    setTimeout(() => (copyBtn.textContent = "Copy"), 1200);
    return;
  }
// --- Share button ---
const shareBtn = ev.target.closest(".btn-share");
if (shareBtn) {
  const postId = shareBtn.dataset.id;
  const url = `${window.location.origin}${window.location.pathname}?id=${postId}`;
  try {
    await navigator.clipboard.writeText(url);
    alert("Link copied: " + url);
  } catch {
    // fallback
    const ta = document.createElement("textarea");
    ta.value = url;
    document.body.appendChild(ta);
    ta.select();
    document.execCommand("copy");
    document.body.removeChild(ta);
    alert("Link copied: " + url);
  }
  return;
}
  // --- Reaction button ---
  const reactBtn = ev.target.closest(".btn-react");
  if (reactBtn) {
    const postEl = reactBtn.closest(".post");
    const postId = postEl.dataset.id;
    const type = reactBtn.dataset.type;

    if (!user) return alert("Please login first!");

    const ref = doc(db, "posts", postId);
    await updateDoc(ref, { [`reactions.${user.uid}`]: type });
  }
});
    // ‚úÖ Search filter (caption + username)
searchInput.addEventListener("input", ()=>{
  const term = searchInput.value.trim().toLowerCase();

  feedEl.querySelectorAll(".post").forEach(p=>{
    const caption = p.querySelector(".caption")?.textContent?.toLowerCase() || "";
    const username = p.querySelector(".username")?.textContent?.toLowerCase() || "";

    if(caption.includes(term) || username.includes(term)){
      p.style.display = "";
    } else {
      p.style.display = "none";
    }
  });
});
    profileBtn.addEventListener("click",()=>location.href="profile.html");
    modeBtn.addEventListener("click",()=>{
      document.body.classList.toggle("dark");
      localStorage.setItem("ps_theme_dark", document.body.classList.contains("dark")?"1":"0");
    });
    (function(){ if(localStorage.getItem("ps_theme_dark")==="1") document.body.classList.add("dark"); })();
    window.addEventListener("scroll",()=>{
      if(window.innerHeight+window.scrollY>=document.body.offsetHeight-260) renderNext();
    });

    // ---------- Auth ----------
// ---------- Auth & Routing ----------
const urlParams = new URLSearchParams(window.location.search);
const postIdFromUrl = urlParams.get("id");

if (postIdFromUrl) {
  // üëâ single post view: guest allowed
  async function loadSinglePost(id, isGuest = false) {
    const snap = await getDoc(doc(db, "posts", id));
    if (snap.exists()) {
      const p = { id: snap.id, ...snap.data() };
      await loadUsersForPosts([p.uid]);
      p.name = userCache[p.uid] || "Unknown";
      p.color = randomColor();

      feedEl.innerHTML = "";
      feedEl.appendChild(renderPost(p));
      updateSEOMeta(p);
      // guest ‡¶π‡¶≤‡ßá signup ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá
      if (isGuest) {
        const msg = document.createElement("div");
        msg.className = "card";
        msg.style.textAlign = "center";
        msg.style.marginTop = "16px";
        msg.innerHTML = `
          <p style="font-size:15px; margin-bottom:12px;">
            Want to see more trending prompts? <br>
            <b>Sign up now!</b>
          </p>
          <button id="signupBtn" class="btn-copy" style="font-size:14px;">
            Sign up / Login
          </button>
        `;
        feedEl.appendChild(msg);

        document.getElementById("signupBtn").addEventListener("click", () => {
          location.href = "index.html";
        });
      }

      loadingEl.style.display = "none";
    } else {
      feedEl.innerHTML = `<div class="empty">Post not found!</div>`;
    }
  }

  // auth state check
  onAuthStateChanged(auth, async (u) => {
    if (u) {
      user = u;
      loadSinglePost(postIdFromUrl);
    } else {
      // guest ‡¶π‡¶≤‡ßá‡¶ì single post ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá
      loadSinglePost(postIdFromUrl, true);
    }
  });

} else {
  // üëâ feed view: ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶≤‡¶ó‡¶á‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞
  onAuthStateChanged(auth, async (u) => {
    if (u) {
      user = u;
      subscribeToPosts();
    } else {
      // guest ‡¶π‡¶≤‡ßá ‡¶´‡¶ø‡¶° ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá ‡¶®‡¶æ
      location.href = "index.html";
    }
  });
    }
  </script>
<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("/sw.js")
    .then(() => console.log("‚úÖ Service Worker Registered"))
    .catch((err) => console.log("‚ùå SW registration failed:", err));
}
</script>
</body>
</html>
