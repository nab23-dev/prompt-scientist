<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Prompt-Scientist | Feed</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
body {
  font-family: 'Poppins', sans-serif;
  background: #f5f5f5;
  margin:0;
  padding:0;
  display:flex;
  flex-direction:column;
  min-height:100vh;
}

.header {
  position: sticky;
  top:0;
  background:#fff;
  padding:15px 20px;
  font-family: 'Montserrat', sans-serif;
  font-weight:700;
  font-size:22px;
  color:#444;
  border-bottom:1px solid #eee;
  z-index:100;
  display:flex;
  justify-content:space-between;
  align-items:center;
  box-shadow:0 2px 6px rgba(0,0,0,0.05);
}

.header .title { font-weight:700; }
.header .profile-icon{
  font-size:22px;
  cursor:pointer;
  transition:0.3s;
}
.header .profile-icon:hover{ color:#333; }

.feed-container {
  flex:1;
  max-width:600px;
  margin:20px auto;
  width:95%;
}

.post-card {
  background:#fff;
  border-radius:18px;
  box-shadow:0 6px 25px rgba(0,0,0,0.08);
  margin-bottom:20px;
  padding:20px;
  transition:transform 0.3s, box-shadow 0.3s;
  opacity:0;
}
.post-card.visible{
  opacity:1;
  transition: opacity 0.8s ease, transform 0.3s ease;
}
.post-card:hover{ transform: translateY(-5px); box-shadow:0 10px 30px rgba(0,0,0,0.12); }

.post-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-bottom:10px;
}
.post-header .username{ font-weight:600; color:#333; }
.post-header .time{ font-size:12px; color:#888; }

.post-image img{
  width:100%;
  border-radius:15px;
  margin:10px 0;
  transition:transform 0.3s;
}
.post-image img:hover{ transform: scale(1.03); }

.post-prompt{
  background:#f0f0f0;
  padding:12px;
  border-radius:12px;
  font-family: monospace;
  font-size:14px;
  margin-bottom:10px;
  position:relative;
}

.copy-btn{
  position:absolute;
  right:10px;
  top:10px;
  background:#333;
  color:#fff;
  border:none;
  padding:5px 10px;
  border-radius:8px;
  cursor:pointer;
  font-size:12px;
  transition:0.3s;
}
.copy-btn:hover{ background:#555; }

.post-actions{
  display:flex;
  justify-content:space-around;
  margin-top:10px;
}
.post-actions button{
  border:none;
  background:none;
  cursor:pointer;
  font-weight:600;
  color:#555;
  transition:0.3s;
}
.post-actions button:hover{ color:#111; }

footer{
  text-align:center;
  padding:12px;
  font-size:13px;
  color:#666;
}

@keyframes fadeSlide{ from{opacity:0; transform:translateX(-40px);} to{opacity:1; transform:translateX(0);} }
</style>
</head>
<body>

<div class="header">
  <div class="title">Prompt-Scientist</div>
  <div class="profile-icon" id="profileIcon">ðŸ‘¤</div>
</div>

<div class="feed-container" id="feedContainer">
  <!-- Posts + Ads injected here -->
</div>

<footer>Â© 2025 Prompt-Scientist. All rights reserved.</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
import { getFirestore, collection, getDocs, query, orderBy, limit, startAfter } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyDDgwI90DMBa25JOkNR2Oec32kfgIt5TNg",
  authDomain: "prompt-scientist.firebaseapp.com",
  projectId: "prompt-scientist",
  storageBucket: "prompt-scientist.firebasestorage.app",
  messagingSenderId: "240705146800",
  appId: "1:240705146800:web:e7f05107761f4d3007d075"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const feedContainer = document.getElementById("feedContainer");
const profileIcon = document.getElementById("profileIcon");

let lastVisible = null;
let loading = false;
let currentUser = null;

// Auto-login check
onAuthStateChanged(auth, (user) => {
  if(!user){
    window.location.href = "signup.html";
  } else {
    currentUser = user;
    loadFeed();
  }
});

// Profile Icon Click
profileIcon.addEventListener("click", ()=>{
  window.location.href = "profile.html";
});

// Load Feed + Random Ads
async function loadFeed(){
  if(loading) return;
  loading = true;

  const postsCol = collection(db,"posts");
  let q;
  if(lastVisible){
    q = query(postsCol, orderBy("createdAt","desc"), startAfter(lastVisible), limit(5));
  }else{
    q = query(postsCol, orderBy("createdAt","desc"), limit(5));
  }

  const snapshot = await getDocs(q);
  if(snapshot.empty){ loading=false; return; }

  lastVisible = snapshot.docs[snapshot.docs.length-1];
  const posts = snapshot.docs.map(doc=>doc.data());

  // Ads
  const ads = [
    {img:"https://via.placeholder.com/600x200?text=Ad+1",link:"#"},
    {img:"https://via.placeholder.com/600x200?text=Ad+2",link:"#"},
    {img:"https://via.placeholder.com/600x200?text=Ad+3",link:"#"}
  ];

  const feedItems = [];
  posts.forEach(post=>{
    feedItems.push({type:"post",data:post});
    if(Math.random()<0.3){
      const ad = ads[Math.floor(Math.random()*ads.length)];
      feedItems.push({type:"ad",data:ad});
    }
  });

  feedItems.forEach(item=>{
    if(item.type==="post"){
      feedContainer.appendChild(createPostCard(item.data));
    }else{
      feedContainer.appendChild(createAdCard(item.data));
    }
  });

  // fade-in animation
  document.querySelectorAll('.post-card:not(.visible)').forEach(card=>{
    setTimeout(()=>card.classList.add('visible'),100);
  });

  loading = false;
}

// Create Post Card
function createPostCard(post){
  const card = document.createElement("div");
  card.className = "post-card";
  
  const header = document.createElement("div");
  header.className="post-header";
  header.innerHTML=`<span class="username">${post.username}</span> <span class="time">${new Date(post.createdAt.seconds*1000).toLocaleString()}</span>`;
  card.appendChild(header);

  if(post.image){
    const imgDiv = document.createElement("div");
    imgDiv.className="post-image";
    imgDiv.innerHTML=`<img src="${post.image}" alt="post image">`;
    card.appendChild(imgDiv);
  }

  const promptDiv = document.createElement("div");
  promptDiv.className="post-prompt";
  promptDiv.textContent=post.prompt;
  const copyBtn = document.createElement("button");
  copyBtn.className="copy-btn";
  copyBtn.textContent="Copy";
  copyBtn.onclick=()=>{ navigator.clipboard.writeText(post.prompt); alert("Prompt copied!"); };
  promptDiv.appendChild(copyBtn);
  card.appendChild(promptDiv);

  const actions = document.createElement("div");
  actions.className="post-actions";
  actions.innerHTML=`<button>Like</button><button>Comment</button><button>Share</button>`;
  card.appendChild(actions);

  return card;
}

// Create Ad Card
function createAdCard(ad){
  const card = document.createElement("div");
  card.className="post-card";
  card.style.background="#fff";

  const imgDiv = document.createElement("div");
  imgDiv.className="post-image";
  imgDiv.innerHTML=`<img src="${ad.img}" style="cursor:pointer" onclick="window.open('${ad.link}','_blank')">`;
  card.appendChild(imgDiv);
  return card;
}

// Infinity Scroll
window.addEventListener('scroll', ()=>{
  if(window.innerHeight + window.scrollY >= document.body.offsetHeight - 300){
    loadFeed();
  }
});
</script>
</body>
</html>